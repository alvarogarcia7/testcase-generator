requirement: "VARIABLE_EXAMPLE_001"
item: 1
tc: 1
id: 'SIMPLE_VARIABLE_EXAMPLE'
description: 'Demonstrates basic variable capture and reuse across test steps'

general_initial_conditions:
  system:
    - "Shell environment is available"

initial_conditions:
  system:
    - "All commands can be executed"

test_sequences:
  - id: 1
    name: "Basic Variable Capture and Reuse"
    description: |
                   Demonstrates capturing a value from one command's output
                   and using it in subsequent commands
    initial_conditions:
      system:
        - "Shell is ready"
    steps:
      - step: 1
        description: "Generate a timestamp value"
        command: date +%s
        capture_vars:
          timestamp: '^\d+$'
        expected:
          success: true
          result: 0
          output: ""
        verification:
          result: "[[ $EXIT_CODE -eq 0 ]]"
          output: "[[ -n \"$COMMAND_OUTPUT\" ]]"
      - step: 2
        description: "Use captured timestamp in echo command"
        command: echo "Captured timestamp is ${STEP_VARS[timestamp]}"
        expected:
          success: true
          result: 0
          output: "Captured timestamp is"
        verification:
          result: "[[ $EXIT_CODE -eq 0 ]]"
          output: "grep -q 'Captured timestamp is' <<< \"$COMMAND_OUTPUT\""
      - step: 3
        description: "Create a file with the timestamp in its name"
        command: touch /tmp/test_${STEP_VARS[timestamp]}.txt && ls /tmp/test_${STEP_VARS[timestamp]}.txt
        expected:
          success: true
          result: 0
          output: "/tmp/test_"
        verification:
          result: "[[ $EXIT_CODE -eq 0 ]]"
          output: "grep -q '/tmp/test_' <<< \"$COMMAND_OUTPUT\""
      - step: 4
        description: "Cleanup test file"
        command: rm -f /tmp/test_${STEP_VARS[timestamp]}.txt
        expected:
          success: true
          result: 0
          output: ""
        verification:
          result: "[[ $EXIT_CODE -eq 0 ]]"
          output: "true"
