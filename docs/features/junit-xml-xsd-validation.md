# JUnit XML XSD Validation

## Overview

The JUnit XML output generated by the testcase-manager is validated against the Maven Surefire plugin XSD schema to ensure compatibility with standard JUnit XML consumers like Jenkins, GitLab CI, and other CI/CD tools.

## XSD Schema Reference

The official Maven Surefire XSD schema is located at:
**https://maven.apache.org/surefire/maven-surefire-plugin/xsd/surefire-test-report.xsd**

## Validation Implementation

The validation is implemented in `tests/junit_export_test.rs` using the `roxmltree` library for XML parsing. The `validate_junit_xml_against_xsd()` function performs structural validation based on the XSD schema requirements.

## Validated Elements and Attributes

### testsuite Element (Root)
- **Required Attributes:**
  - `name`: Name of the test suite
  - `tests`: Total number of tests (must be a non-negative integer)
  - `failures`: Number of failed tests (must be a non-negative integer)
  - `skipped`: Number of skipped tests (must be a non-negative integer)
  - `time`: Total execution time in seconds (must be a non-negative decimal)

### testcase Elements
- **Required Attributes:**
  - `name`: Name of the test case
  - `time`: Execution time in seconds (must be a non-negative decimal)
- **Optional Attributes:**
  - `id`: Test case identifier
  - `timestamp`: ISO 8601 timestamp of test execution

### failure Elements
- **Requirements:**
  - Must have either a `message` attribute or text content
  - Nested within a `testcase` element
  - Count must match the `failures` attribute of parent `testsuite`

### skipped Elements
- **Requirements:**
  - Optional `message` attribute
  - Nested within a `testcase` element
  - Count must match the `skipped` attribute of parent `testsuite`

### error Elements
- **Requirements:**
  - Must have either a `message` attribute or text content
  - Nested within a `testcase` element

## Validation Tests

The following tests validate XSD compliance:

1. **test_single_test_run_pass**: Validates passing test XML structure
2. **test_single_test_run_fail**: Validates failing test XML structure
3. **test_single_test_run_skip**: Validates skipped test XML structure
4. **test_junit_xml_structure_validation**: Validates overall XML structure
5. **test_multiple_test_runs_different_statuses**: Validates all status types
6. **test_junit_xml_xsd_compliance**: Comprehensive XSD compliance test

## Example Validation

```rust
use testcase_manager::{TestRun, TestRunStatus};
use chrono::Utc;

let test_run = TestRun::new(
    "TC001".to_string(),
    TestRunStatus::Pass,
    Utc::now(),
    1.5,
);

let xml = test_run.to_junit_xml();

// This will validate the XML against XSD requirements
validate_junit_xml_against_xsd(&xml);
```

## Validation Checks Performed

1. **XML Well-formedness**: Ensures the XML is properly formatted and parseable
2. **Element Structure**: Verifies correct nesting and hierarchy
3. **Required Attributes**: Checks all required attributes are present
4. **Type Validation**: Ensures numeric attributes contain valid numbers
5. **Count Consistency**: Verifies element counts match attribute values
6. **Non-negative Values**: Ensures time values are non-negative

## Running Validation Tests

To run the XSD validation tests:

```bash
cargo test test_junit_xml_xsd_compliance
cargo test --test junit_export_test
```

## Benefits of XSD Validation

1. **Compatibility**: Ensures output works with all JUnit XML consumers
2. **Standards Compliance**: Adheres to Maven Surefire plugin standards
3. **Quality Assurance**: Catches structural issues early in development
4. **CI/CD Integration**: Guarantees proper integration with CI/CD pipelines
5. **Error Prevention**: Prevents invalid XML from being generated

## Limitations

The current implementation validates structural and basic type constraints based on the XSD schema. It does not perform full XSD schema validation (which would require complex XSD processing libraries). However, the validation covers all critical aspects needed for JUnit XML compatibility.

## Future Enhancements

Potential improvements for more comprehensive validation:
- Integration with full XSD validation libraries when available
- Additional constraints from the schema specification
- Performance metrics validation
- Extended attribute validation
