stages:
  - validate

variables:
  PIP_CACHE_DIR: "$CI_PROJECT_DIR/.cache/pip"

cache:
  paths:
    - .cache/pip

validate_schemas:
  stage: validate
  image: python:3.14
  before_script:
    - pip install uv
    - uv sync
    - source .venv/bin/activate
  script:
    - echo "Validating YAML files against schemas..."
    - |
      for yaml_file in samples/test-plan/*.yml; do
        python validator.py "$yaml_file" schemas/test-plan/test-plan.schema.json
      done
    - |
      for yaml_file in samples/test-case/*.yml; do
        python validator.py "$yaml_file" schemas/test-case/test-case.schema.json
      done
    - echo "All validations passed!"
  only:
    - branches
    - merge_requests
